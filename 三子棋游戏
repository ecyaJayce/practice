//三子棋
#include<stdio.h>
#include<time.h>
#include<stdlib.h>
#define Row 3
#define Col 3
int i=0;
int j=0;
int x=0;
int y=0;
int count=0;
void menu()
{
	printf("*******************");
	printf("***1.Play 0.Exit***");
	printf("*******************");
}

void Inilboard(char board[Row][Col],int row,int col)
{
	for(i=0;i<row;i++)
	{
		for(j=0;j<col;j++)
		{
			board[i][j]='0';
		}
	}
}

void Displayboard(char board[Row][Col],int row,int col)
{
	for (i=0;i<row;i++)
	{
		for(j=0;j<col;j++)
		{
			if(j!=col-1)
			{
				printf(" %c |",board[i][j]);
			}
			else
			{
				printf(" %c ",board[i][j]);
			}
		}
		printf("\n");
		if(i!=row-1)
		{
			for(j=0;j<col;j++)
			{
				if(j!=col-1)
				{
					printf("---|");
				}
				else
				{
					printf("---");
				}
			}
			printf("\n");
		}
	}
}

void PlayerMove(char board[Row][Col],int row,int col)
{
	printf("请输入坐标：");
PMove:
	scanf("%d%d",&x,&y);
	if(x>=1&&x<=Row)
	{
		if(y>=1&&y<=Col)
		{
			if(board[x-1][y-1]=='0')
			{
				board[x-1][y-1]='*';
			}
			else
			{
				printf("此格已有子，请重新输入坐标：");
				goto PMove;
			}
		}
		else
		{
			printf("超出棋盘范围，请重新输入坐标：");
			goto PMove;
		}
	}
	else
	{
		printf("超出棋盘范围，请重新输入坐标：");
		goto PMove;
	}
	Displayboard(board,Row,Col);
	count++;
}

void ComputerMove(char board[Row][Col],int row,int col)
{
	while(1)
	{
		x=rand()%3;
		y=rand()%3;
		if(board[x][y]=='0')
		{
			board[x][y]='#';
			break;
		}
	}
	Displayboard(board,Row,Col);
	count++;
}

int IsFull()
{
	if(count==Row*Col)
		return 1;
	else
		return 0;
}

char IsWin(char board[Row][Col],int row,int col)
{
	for(i=0;i<row;i++)
	{
		if(board[i][0]==board[i][1]&&board[i][2]==board[i][1]&&board[i][1]!='0')
		{
			return board[i][1];
		}
		else if(board[0][i]==board[1][i]&&board[2][i]==board[1][i]&&board[1][i]!='0')
		{
			return board[1][i];
		}
	}
	if((board[0][0]==board[1][1]&&board[1][1]==board[2][2]&&board[1][1]!='0')||(board[2][0]==board[1][1]&&board[1][1]==board[0][2]&&board[1][1]!='0'))
		return board[1][1];
	if(1==IsFull())
		return 'P';
	else
		return 'C';
}

void game()
{	
	count=0;
	char ret='0';
	char board[Row][Col]={0};
	Inilboard(board,Row,Col);
	Displayboard(board,Row,Col);
	while(1)
	{
	PlayerMove(board,Row,Col);
	ret=IsWin(board,Row,Col);
	if(ret!='C')
		{
			break;
		}
	ComputerMove(board,Row,Col);
	ret=IsWin(board,Row,Col);
	if(ret!='C')
		{
			break;
		}
	}
}

void test()
{
	int input=1;
	do
	{
		menu();
		printf("请选择:");
		scanf("%d",&input);
		switch(input)
		{
		case 1:
			printf("开始游戏\n");
			game();
			break;
		case 0:
			printf("退出游戏\n");
			break;
		default:
			printf("选择错误，请重新选择\n");
			break;
		}
	}while(input);
}

int main()
{
	srand((unsigned int)time(NULL));
	test();
	return 0;
}
